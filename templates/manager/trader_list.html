{% extends 'manager/base.html' %}
{% load static %}
{% block content %}
<div class="content-body">
    <div class="container-fluid">

        <!-- Breadcrumb -->
        <div class="row">
            <div class="col-xl-12">
                <div class="page-titles">
                    <nav style="--bs-breadcrumb-divider: '>';">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="admin-dashboard.html">Dashboard</a></li>
                            <li class="breadcrumb-item active">Traders</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">All Traders (12)</h1>
            <button class="btn-add-trader" onclick="window.location.href='trader-add.html'">
                <i class="material-icons">add</i>
                <span>Add New Trader</span>
            </button>
        </div>

        <!-- Traders Grid -->
        <div class="traders-grid">

            {% for trader in traders %}
            <div class="trader-card">
                <div class="trader-header">
                    <div class="trader-avatar">
                        <!-- {{ trader.full_name|slice:":2"|upper }} -->
                          <img src="{{trader.image.url}}" class="img-fluid" alt="">
                    </div>
                    <div class="trader-info">
                        <div class="trader-name">
                            {{ trader.full_name }}
                            <span class="verified-badge">
                                <i class="material-icons" style="font-size: 12px;">verified</i>
                                Verified
                            </span>
                        </div>
                        <div class="trader-username">@{{ trader.username }}</div>
                    </div>
                </div>

                <div class="trader-stats">
                    <div class="stat-item">
                        <div class="stat-label">Win Rate</div>
                        <div class="stat-value success">{{ trader.win_rate }}%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Profit Share</div>
                        <div class="stat-value">{{ trader.profit_share }}%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Wins</div>
                        <div class="stat-value success">{{ trader.win }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Losses</div>
                        <div class="stat-value danger">{{ trader.lose }}</div>
                    </div>
                </div>

                <div class="config-section">
                    <div class="config-row">
                        <span class="config-label">Copy Mode:</span>
                        <span class="badge-mode flexible">Flexible</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Min. Balance:</span>
                        <span class="config-value">${{ trader.min_balance|floatformat:0 }}</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Approval Required:</span>
                        <span class="config-value" style="color: #10b981;">No</span>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Copiers:</span>
                        <span class="config-value">{{ trader.copier }}</span>
                    </div>
                </div>

                <div class="status-toggle">
                    <input type="checkbox" id="trader{{ trader.id }}" checked>
                    <label for="trader{{ trader.id }}">Active & Visible</label>
                </div>

                <div class="trader-actions">
                    <a class="btn-edit" href="{% url 'edit_trader' trader.ref %}">
                        <i class="material-icons" style="font-size: 18px;">edit</i>
                        Edit
                    </a>
                    <form action="" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="ref" value="{{trader.ref}}">
                        <button type="submit" class="btn-delete">
                            <i class="material-icons" style="font-size: 18px;">delete</i>
                        </button>
                    </form>
                </div>
            </div>
            {% empty %}
            <p>No traders found.</p>
            {% endfor %}

        </div>

    </div>
</div>
{% endblock %}
{% block extra_script %}
<script>
    function deleteTrader(name) {
        if (confirm(`Delete trader "${name}"?\n\nThis will also affect all users currently copying this trader. Are you sure?`)) {
            alert(`Trader "${name}" deleted successfully! (Demo)`);
            location.reload();
        }
    }

    // Mobile Sidebar Toggle
    (function() {
        let overlay = document.querySelector('.sidebar-overlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.className = 'sidebar-overlay';
            document.body.appendChild(overlay);
        }

        const hamburger = document.querySelector('.hamburger');
        const sidebar = document.querySelector('.dlabnav');

        if (hamburger && sidebar) {
            hamburger.addEventListener('click', function(e) {
                e.stopPropagation();
                hamburger.classList.toggle('is-active');
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
            });

            overlay.addEventListener('click', function() {
                hamburger.classList.remove('is-active');
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            });

            sidebar.querySelectorAll('a').forEach(function(link) {
                link.addEventListener('click', function() {
                    if (window.innerWidth < 768) {
                        setTimeout(function() {
                            hamburger.classList.remove('is-active');
                            sidebar.classList.remove('active');
                            overlay.classList.remove('active');
                            document.body.style.overflow = '';
                        }, 300);
                    }
                });
            });

            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768) {
                    hamburger.classList.remove('is-active');
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    })();

</script>
{% endblock %}