{% extends 'manager/base.html' %}
{% load static %}

{% block content %}
<div class="content-body">
    <div class="container-fluid">

        <!-- Page Header -->
        <div class="page-header">
            <h2>Manage Trader Benefits</h2>
            <p>Add, edit, or remove benefit cards shown on the "Become a Trader" page</p>
        </div>

        <!-- Info Alert -->
        <div class="alert alert-info">
            <i class="material-icons">info</i>
            <div>
                <strong>Note:</strong> Changes made here will appear on the user-facing "Become a Trader" application page. Cards are displayed in the order shown below.
            </div>
        </div>

        <!-- Cards Grid -->
        <div class="cards-grid">
            {% for card in benefits %}
            <div class="benefit-card-admin">
                <div class="benefit-card-preview">
                    <i class="material-icons">{{ card.icon }}</i>
                    <h4>{{ card.title }}</h4>
                    <p>{{ card.description }}</p>
                </div>

                <div class="card-actions">
                    <!-- EDIT BUTTON -->
                    <button class="btn btn-secondary btn-sm"
                        style="flex: 1;"
                        data-bs-toggle="modal"
                        data-bs-target="#cardModal"
                        onclick="loadCardForEdit('{{ card.title }}', '{{ card.icon }}', '{{ card.description }}', '{{ card.id }}')">
                        <i class="material-icons">edit</i>
                        Edit
                    </button>

                    <!-- DELETE BUTTON -->
                    <form method="POST" style="margin: 0;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="card_id" value="{{ card.id }}">
                        <button class="btn btn-danger btn-sm btn-icon">
                            <i class="material-icons">delete</i>
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}

            <!-- Add New Card -->
            <div class="add-card-button"
                 data-bs-toggle="modal"
                 data-bs-target="#cardModal"
                 onclick="resetModalForAdd()">
                <i class="material-icons">add_circle</i>
                <h4>Add New Benefit</h4>
                <p>Click to create a new benefit card</p>
            </div>
        </div>

    </div>
</div>

<!-- Modal Form for Add/Edit -->
<div class="modal fade" id="cardModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add Benefit Card</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form id="cardForm" method="POST">
                {% csrf_token %}
                <div class="modal-body">
                    <input type="hidden" name="card_id" id="cardId">

                    <div class="form-group mb-3">
                        <label class="form-label">Select Icon <span class="text-danger">*</span></label>
                        <select class="form-select" name="card_icon" id="cardIcon" required>
                            <option value="">Choose an icon...</option>
                            <option value="payments">ğŸ’° Payments</option>
                            <option value="group">ğŸ‘¥ Group</option>
                            <option value="analytics">ğŸ“Š Analytics</option>
                            <option value="verified">âœ“ Verified</option>
                            <option value="trending_up">ğŸ“ˆ Trending Up</option>
                            <option value="star">â­ Star</option>
                            <option value="workspace_premium">ğŸ† Premium</option>
                            <option value="emoji_events">ğŸ… Events</option>
                            <option value="military_tech">ğŸ–ï¸ Military Tech</option>
                            <option value="shield">ğŸ›¡ï¸ Shield</option>
                            <option value="local_atm">ğŸ’µ ATM</option>
                            <option value="account_balance">ğŸ¦ Account Balance</option>
                            <option value="attach_money">ğŸ’² Attach Money</option>
                            <option value="monetization_on">ğŸ’° Monetization</option>
                            <option value="security">ğŸ”’ Security</option>
                            <option value="check_circle">âœ“ Check Circle</option>
                            <option value="thumb_up">ğŸ‘ Thumb Up</option>
                            <option value="favorite">â¤ï¸ Favorite</option>
                            <option value="visibility">ğŸ‘ï¸ Visibility</option>
                            <option value="groups">ğŸ‘¥ Groups</option>
                            <option value="support_agent">ğŸ§ Support</option>
                            <option value="handshake">ğŸ¤ Handshake</option>
                            <option value="business_center">ğŸ’¼ Business</option>
                        </select>
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label">Card Title <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="card_title" id="cardTitle" placeholder="e.g., Earn Extra Income" required>
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label">Card Description <span class="text-danger">*</span></label>
                        <textarea class="form-control" name="card_description" id="cardDescription" rows="3" placeholder="Brief description of this benefit..." required></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="material-icons">close</i>
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="material-icons">save</i>
                        Save Card
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_script %}
<script>
    // Reset modal for adding new card
    function resetModalForAdd() {
        document.getElementById('modalTitle').textContent = 'Add Benefit Card';
        document.getElementById('cardForm').reset();
        document.getElementById('cardId').value = '';
    }

    // Load card data into modal for editing
    function loadCardForEdit(title, icon, description, id) {
        document.getElementById('modalTitle').textContent = 'Edit Benefit Card';
        document.getElementById('cardId').value = id;
        document.getElementById('cardTitle').value = title;
        document.getElementById('cardIcon').value = icon;
        document.getElementById('cardDescription').value = description;
    }
</script>
{% endblock %}
