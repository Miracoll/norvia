{% extends 'manager/base.html' %}
{% load static %}
{% block content %}
<div class="content-body">
    <div class="container-fluid">

        <!-- Breadcrumb -->
        <div class="row">
            <div class="col-xl-12">
                <div class="page-titles">
                    <nav style="--bs-breadcrumb-divider: '>';">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'admin_home' %}">Dashboard</a></li>
                            <li class="breadcrumb-item active">Withdrawals</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">
                Withdrawals ({{ total_withdrawals_count }} Total)
            </h1>
        </div>
        
        <!-- Stats Mini Cards -->
        <div class="stats-row">
            <div class="stat-mini">
                <div class="stat-mini-label">Total Withdrawals (Today)</div>
                <div class="stat-mini-value" style="color: #ef4444;">
                    ${{ total_withdrawals_today|floatformat:2 }}
                </div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-label">Pending Approval</div>
                <div class="stat-mini-value" style="color: #f59e0b;">
                    {{ pending_approval }}
                </div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-label">Completed (Today)</div>
                <div class="stat-mini-value" style="color: #10b981;">
                    {{ completed_today }}
                </div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-label">Rejected (Today)</div>
                <div class="stat-mini-value" style="color: #ef4444;">
                    {{ rejected_today }}
                </div>
            </div>
        </div>        

        <!-- Filters -->
        <div class="filters-card">
            <div class="filters-row">
                <input type="text" class="filter-input" placeholder="Search by user or transaction ID...">
                <select class="filter-select">
                    <option>All Status</option>
                    <option>Pending</option>
                    <option>Processing</option>
                    <option>Completed</option>
                    <option>Rejected</option>
                </select>
                <select class="filter-select">
                    <option>All Methods</option>
                    <option>Cryptocurrency</option>
                    <option>PayPal</option>
                    <option>Bank Transfer</option>
                    <option>Cash App</option>
                </select>
                <select class="filter-select">
                    <option>All Dates</option>
                    <option>Today</option>
                    <option>Last 7 days</option>
                    <option>Last 30 days</option>
                </select>
            </div>
            <button class="btn btn-primary">Apply Filters</button>
        </div>

        <!-- Withdrawals Table -->
        <div class="withdrawals-table-card">
            <div class="table-responsive">
                <table class="withdrawals-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Destination</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for withdraw in withdraws %}
                        <tr>
                            <td>
                                <div class="user-cell">
                                    <div class="user-avatar">{{withdraw.user.first_name|slice:1}}{{withdraw.user.last_name|slice:1}}</div>
                                    <div>
                                        <div class="user-name">{{withdraw.user.first_name|capfirst}} {{withdraw.user.last_name|capfirst}}</div>
                                        <div class="user-id">#USR-{{withdraw.user.id}}</div>
                                    </div>
                                </div>
                            </td>
                            <td><strong style="color: #ef4444;">${{withdraw.amount}}</strong></td>
                            <td>
                                {% if withdraw.currency %}
                                {{withdraw.currency}}
                                {% else %}
                                {{withdraw.gateway}}
                                {% endif %}
                            </td>
                            <td>
                                {% if withdraw.currency %}
                                {{withdraw.wallet_address}}
                                {% else %}
                                {{withdraw.email}}
                                {% endif %}
                            </td>
                            <td><span class="status-badge {% if withdraw.status == 'success' %}completed{% elif withdraw.status == 'pending' %}pending{% else %}rejected{% endif %}">{{withdraw.status}}</span></td>
                            <td>{{ withdraw.date|timesince }} ago</td>
                            <td>
                                <div class="action-buttons">
                                    <form method="POST" action="" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="{{withdraw.ref}}">
                                        <button type="submit" class="btn-approve" name="approve">
                                            <i class="material-icons" style="font-size: 16px;">check</i>
                                            Approve
                                        </button>
                                    </form>
                                    <form method="POST" action="" style="display: inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="{{withdraw.ref}}">
                                        <button type="submit" class="btn-reject" name="reject">
                                            <i class="material-icons" style="font-size: 16px;">close</i>
                                            Reject
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
{% endblock %}