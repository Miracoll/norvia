{% extends 'manager/base.html' %}
{% load static %}
{% block content %}
<div class="content-body">
    <div class="container-fluid">

        <!-- Breadcrumb -->
        <div class="row">
            <div class="col-xl-12">
                <div class="page-titles">
                    <nav style="--bs-breadcrumb-divider: '>';">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'admin_home' %}">Dashboard</a></li>
                            <li class="breadcrumb-item active">User Account Settings</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">User Account Settings</h1>
        </div>

        <!-- Section: General Settings -->
        <div class="settings-section">
            <h2 class="section-title">
                <i class="material-icons">settings</i>
                General Settings
            </h2>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}

                <p class="card-description">Configure basic platform settings and preferences.</p>

                <div class="form-group">
                    <label class="form-label">Platform Name</label>
                    <input type="text" class="form-input" name="platform_name" value="{{config.platform_name}}" />
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Deposit Amount (USD)</label>
                    <input type="number" class="form-input" name="min_deposit" value="{{config.minimum_withdrawal}}" step="0.01" />
                    <div class="form-help">Minimum amount users can deposit</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Withdrawal Amount (USD)</label>
                    <input type="number" class="form-input" name="min_withdrawal" value="{{config.maximum_withdrawal}}" step="0.01" />
                    <div class="form-help">Minimum amount users can withdraw</div>
                </div>

                <div class="form-group">
                    <label class="form-label">New User Registration</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input type="checkbox" name="allow_registration" value="1" {% if config.registration_status %} checked {% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">Allow New Registrations</span>
                    </div>
                </div>

                <button type="submit" class="btn-save" name="general_setting">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Changes
                </button>
            </form>
        </div>

        <!-- Section: Account Defaults & Restrictions -->
        <div class="settings-section">
            <h2 class="section-title">
                <i class="material-icons">account_circle</i>
                Account Defaults & Restrictions
            </h2>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}

                <div class="card-header">
                    <h3 class="card-title">
                        <i class="material-icons">person_add</i>
                        New User Defaults
                    </h3>
                </div>
                <p class="card-description">Configure default settings applied to all new user accounts.</p>

                <div class="form-group">
                    <label class="form-label">Default Language</label>
                    <select class="form-select" name="default_language">
                        <option value="en" {% if config.default_language == 'en' %}selected{% endif %}>English</option>
                        <option value="es" {% if config.default_language == 'es' %}selected{% endif %}>Spanish</option>
                        <option value="fr" {% if config.default_language == 'fr' %}selected{% endif %}>French</option>
                        <option value="de" {% if config.default_language == 'de' %}selected{% endif %}>German</option>
                        <option value="zh" {% if config.default_language == 'zh' %}selected{% endif %}>Chinese</option>
                        <option value="ja" {% if config.default_language == 'ja' %}selected{% endif %}>Japanese</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Default Currency Display</label>
                    <select class="form-select" name="default_currency">
                        <option value="usd" {% if config.default_currency == 'usd' %}selected{% endif %}>USD ($)</option>
                        <option value="eur" {% if config.default_currency == 'eur' %}selected{% endif %}>EUR (€)</option>
                        <option value="gbp" {% if config.default_currency == 'gbp' %}selected{% endif %}>GBP (£)</option>
                        <option value="btc" {% if config.default_currency == 'btc' %}selected{% endif %}>BTC (₿)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Default Notification Preferences</label>
                    <div class="toggle-switch" style="margin-bottom: 8px;">
                        <label class="switch">
                            <input type="checkbox" name="default_email_notif" value="1" checked>
                            <span class="slider"></span>
                        </label>
                        <span>Email Notifications (Enabled by default)</span>
                    </div>
                </div>

                <button type="submit" class="btn-save" name="save_user_defaults">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Defaults
                </button>
            </form>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}

                <div class="card-header">
                    <h3 class="card-title">
                        <i class="material-icons">lock</i>
                        2FA & Security Requirements
                    </h3>
                </div>
                <p class="card-description">Configure two-factor authentication and security requirements.</p>

                <div class="form-group">
                    <label class="form-label">Require 2FA for All Users</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input type="checkbox" name="require_2fa" value="1"
                                {% if config.mandatory_2fa %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">Mandatory 2FA</span>
                    </div>
                    <div class="form-help">Force all users to enable 2FA before trading</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Require Security Questions</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input type="checkbox" name="require_security_questions" value="1"
                                {% if config.require_security_question %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">Enabled</span>
                    </div>
                    <div class="form-help">Users must set security questions for account recovery</div>
                </div>

                <button type="submit" class="btn-save" name="save_2fa_security">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Security Requirements
                </button>
            </form>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}

                <div class="card-header">
                    <h3 class="card-title">
                        <i class="material-icons">vpn_key</i>
                        Password Policies
                    </h3>
                </div>
                <p class="card-description">Configure password requirements and policies.</p>

                <div class="form-group">
                    <label class="form-label">Minimum Password Length</label>
                    <input type="number" class="form-input" name="min_password_length"
                        value="{{ config.minimum_password_length }}" min="6" max="32" />
                    <div class="form-help">Minimum characters required for passwords</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Password Requirements</label>
                    <div class="toggle-switch" style="margin-bottom: 8px;">
                        <label class="switch">
                            <input type="checkbox" name="require_uppercase" value="1"
                                {% if config.require_uppercase_password %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span>Require Uppercase Letter</span>
                    </div>
                    <div class="toggle-switch" style="margin-bottom: 8px;">
                        <label class="switch">
                            <input type="checkbox" name="require_lowercase" value="1"
                                {% if config.require_lowercase_password %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span>Require Lowercase Letter</span>
                    </div>
                    <div class="toggle-switch" style="margin-bottom: 8px;">
                        <label class="switch">
                            <input type="checkbox" name="require_number" value="1"
                                {% if config.require_number_password %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span>Require Number</span>
                    </div>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input type="checkbox" name="require_special_char" value="1"
                                {% if config.require_special_character_password %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span>Require Special Character</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Failed Login Attempts Before Lockout</label>
                    <input type="number" class="form-input" name="max_failed_logins"
                        value="{{ config.failed_loging_attempts_before_lockout }}" min="3" max="10" />
                    <div class="form-help">Number of failed attempts before temporary lockout</div>
                </div>

                <button type="submit" class="btn-save" name="save_password_policies">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Password Policies
                </button>
            </form>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}

                <div class="card-header">
                    <h3 class="card-title">
                        <i class="material-icons">schedule</i>
                        Session & Activity Settings
                    </h3>
                </div>
                <p class="card-description">Configure user session and activity management.</p>

                <div class="form-group">
                    <label class="form-label">Require Login Notifications</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input type="checkbox" name="login_notifications" value="1"
                                {% if config.login_notifications %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">Enabled</span>
                    </div>
                    <div class="form-help">Send email alerts on new device logins</div>
                </div>

                <button type="submit" class="btn-save" name="save_session_settings">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Session Settings
                </button>
            </form>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}

                <div class="card-header">
                    <h3 class="card-title">
                        <i class="material-icons">star</i>
                        Trader Application Requirements
                    </h3>
                </div>
                <p class="card-description">Set eligibility criteria for users who want to become copy trading leaders.</p>

                <div class="form-group">
                    <label class="form-label">Enable Trader Applications</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input type="checkbox" name="enable_trader_applications" value="1"
                                {% if config.enable_trader_application %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">Enabled</span>
                    </div>
                    <div class="form-help">Allow users to apply to become copy trading leaders</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Trading Balance Required (USD)</label>
                    <input type="number" class="form-input" name="min_trader_balance"
                        value="{{ config.minimum_trading_balance_trader_application }}" step="1000" />
                    <div class="form-help">Minimum balance in trading wallet required to apply as a trader</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Account Age (Days)</label>
                    <input type="number" class="form-input" name="min_account_age"
                        value="{{ config.minimum_account_age_trader_application }}" min="0" />
                    <div class="form-help">Account must be at least this old to apply (0 = no restriction)</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Trading Volume (Last 30 Days, USD)</label>
                    <input type="number" class="form-input" name="min_trading_volume"
                        value="{{ config.minimum_trading_volume_last_30_days_usd }}" step="5000" />
                    <div class="form-help">Minimum trading volume required in the last 30 days</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Require Minimum Win Rate (%)</label>
                    <input type="number" class="form-input" name="min_win_rate"
                        value="{{ config.min_win_rate }}" min="0" max="100" />
                    <div class="form-help">Minimum win rate percentage required (0 = no restriction)</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Application Review Period (Days)</label>
                    <input type="number" class="form-input" name="review_period"
                        value="{{ config.application_review_period_days }}" min="1" max="30" />
                    <div class="form-help">Maximum days to review and respond to applications</div>
                </div>

                <button type="submit" class="btn-save" name="save_trader_requirements">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Trader Requirements
                </button>
            </form>
        </div>

        <!-- Section: Security -->
        <div class="settings-section">
            <h2 class="section-title">
                <i class="material-icons">security</i>
                Security
            </h2>

            <form method="POST" action="" class="settings-card">
                {% csrf_token %}
            
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="material-icons">security</i>
                        Security Settings
                    </h3>
                </div>
                <p class="card-description">Configure security and compliance settings.</p>
            
                <!-- Require 2FA -->
                <div class="form-group">
                    <label class="form-label">Require 2FA for Withdrawals</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input
                                type="checkbox"
                                name="require_2fa_withdrawal"
                                value="1"
                                {% if config.session_timeout_minutes %}checked{% endif %}
                            >
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">
                            {% if config.session_timeout_minutes %}Enabled{% else %}Disabled{% endif %}
                        </span>
                    </div>
                    <div class="form-help">Users must enable 2FA to make withdrawals</div>
                </div>
            
                <!-- Require Email Verification -->
                <div class="form-group">
                    <label class="form-label">Require Email Verification</label>
                    <div class="toggle-switch">
                        <label class="switch">
                            <input
                                type="checkbox"
                                name="require_email_verification"
                                value="1"
                                {% if config.require_email_verification %}checked{% endif %}
                            >
                            <span class="slider"></span>
                        </label>
                        <span style="font-weight: 600;">
                            {% if config.require_email_verification %}Enabled{% else %}Disabled{% endif %}
                        </span>
                    </div>
                    <div class="form-help">Users must verify email before trading</div>
                </div>
            
                <!-- Session Timeout -->
                <div class="form-group">
                    <label class="form-label">Session Timeout (minutes)</label>
                    <input
                        type="number"
                        class="form-input"
                        name="session_timeout"
                        value="{{ config.session_timeout_minutes }}"
                    />
                    <div class="form-help">Auto logout after inactivity</div>
                </div>
            
                <button type="submit" class="btn-save" name="save_security_settings">
                    <i class="material-icons" style="font-size: 18px;">save</i>
                    Save Security Settings
                </button>
            </form>            
        </div>

    </div>
</div>
{% endblock %}