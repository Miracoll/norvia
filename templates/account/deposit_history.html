{% extends "account/base.html" %}
{% load static %}

{% block title %}Deposit History{% endblock %}

{% block body_class %}page-deposithistory{% endblock %}

{% block content %}
<div class="content-body">
			<div class="container-fluid">
				<!-- Breadcrumb -->
				<div class="page-titles">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
						<li class="breadcrumb-item"><a href="javascript:void(0)">Wallet</a></li>
						<li class="breadcrumb-item active">Deposit History</li>
					</ol>
				</div>

				<!-- Page Header -->
				<div class="page-header">
					<div class="page-header-content">
						<div>
							<h3>Deposit History</h3>
							<p class="page-header-subtitle">View all your deposit transactions and their status</p>
						</div>
						<div class="header-actions">
							<a href="{% url 'deposit' %}" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 8px;">
								<i class="material-icons" style="font-size: 20px;">add_circle</i>
								New Deposit
							</a>
						</div>
					</div>
				</div>

				<!-- Filters -->
				<div class="filters-card">
					<div class="filters-row">
						<div class="filter-group">
							<label class="filter-label">Search</label>
							<div class="search-wrapper">
								<i class="material-icons">search</i>
								<input type="text" class="filter-input" id="searchInput" placeholder="Transaction ID, Amount...">
							</div>
						</div>
						<div class="filter-group">
							<label class="filter-label">Status</label>
							<select class="filter-select" id="statusFilter">
								<option value="all">All Status</option>
								<option value="success">Successful</option>
								<option value="pending">Pending</option>
								<option value="failed">Failed</option>
							</select>
						</div>
						<div class="filter-group">
							<label class="filter-label">Currency</label>
							<select class="filter-select" id="currencyFilter">
								<option value="all">All Currencies</option>
								<option value="BTC">Bitcoin (BTC)</option>
								<option value="ETH">Ethereum (ETH)</option>
								<option value="USDT">Tether (USDT)</option>
								<option value="BNB">Binance Coin (BNB)</option>
							</select>
						</div>
						<div class="filter-group" style="display: flex; gap: 8px;">
							<button class="filter-btn primary" onclick="applyFilters()">
								<i class="material-icons" style="font-size: 18px;">filter_list</i>
								Apply
							</button>
							<button class="filter-btn secondary" onclick="resetFilters()">
								<i class="material-icons" style="font-size: 18px;">refresh</i>
								Reset
							</button>
						</div>
					</div>
				</div>

				<!-- Deposits Table -->
				<div class="deposits-card">
					<table class="deposits-table">
						<thead>
							<tr>
								<th>Transaction ID</th>
								<th>Date & Time</th>
								<th>Currency</th>
								<th>Amount</th>
								<th>Network</th>
								<th>Status</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody id="depositsTableBody">
							<!-- Sample transaction data (Django will replace these with real data) -->
							{% for deposit in deposits %}
							<tr>
								<td>
									<strong>#TXN{{deposit.transaction_no}}</strong>
								</td>
								<td>{{deposit.date_created|date:"M d,Y, h:i A"}}</td>
								<td>
									{% if deposit.currency %}
									<div class="currency-badge">
										<div class="currency-icon">{{ deposit.currency.abbr|upper|slice:"0:3" }}</div>
										{{deposit.currency.abbr|upper}}
									</div>
									{% else %}
									<div class="currency-badge">
										<div class="currency-icon">{{ deposit.gateway.name|upper|slice:"0:3" }}</div>
										{{deposit.gateway.name|upper}}
									</div>
									{% endif %}
								</td>
								<td>
									<div class="amount-display">{{deposit.equivalent}} {{deposit.currency.abbr|upper}}</div>
									<div class="amount-usd">â‰ˆ ${{deposit.grand_total}}</div>
								</td>
								<td>TRC20</td>
								<td>
									<span class="status-badge {% if deposit.status == 'paid' %}success{% elif deposit.status == 'pending' %}pending{% else %}failed{% endif %}">
										<i class="material-icons">check_circle</i>
										{{deposit.status}}
									</span>
								</td>
								<td>
									<a href="{% url 'deposit_details' deposit.ref %}" class="action-btn">
										<i class="material-icons">visibility</i>
										View
									</a>
								</td>
							</tr>
							{% endfor %}
							
						</tbody>
					</table>

					<!-- Empty State (shown when no results) -->
					<div class="empty-state" id="emptyState" style="display: none;">
						<i class="material-icons">inbox</i>
						<h4>No Deposits Found</h4>
						<p>You haven't made any deposits yet or no results match your filters.</p>
					</div>

					<!-- Pagination -->
					<div class="pagination-wrapper" id="paginationWrapper">
						<div class="pagination-info">
							Showing <strong id="showingStart">1</strong> to <strong id="showingEnd">5</strong> of <strong id="totalRecords">5</strong> deposits
						</div>
						<div class="pagination">
							<button class="page-btn" onclick="changePage('prev')" id="prevBtn">&lt;</button>
							<button class="page-btn active" onclick="changePage(1)">1</button>
							<button class="page-btn" onclick="changePage(2)">2</button>
							<button class="page-btn" onclick="changePage(3)">3</button>
							<button class="page-btn" onclick="changePage('next')" id="nextBtn">&gt;</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		</div>

		<!-- Footer -->
{% endblock %}

{% block page_scripts %}
<script>
// Filter functionality
function applyFilters() {
	const searchValue = document.getElementById('searchInput').value.toLowerCase();
	const statusValue = document.getElementById('statusFilter').value;
	const currencyValue = document.getElementById('currencyFilter').value;

	const tbody = document.getElementById('depositsTableBody');
	const rows = tbody.getElementsByTagName('tr');
	let visibleCount = 0;

	for (let row of rows) {
		const text = row.textContent.toLowerCase();
		const statusBadge = row.querySelector('.status-badge');
		const currencyBadge = row.querySelector('.currency-badge');

		let statusMatch = true;
		let currencyMatch = true;
		let searchMatch = text.includes(searchValue);

		if (statusValue !== 'all' && statusBadge) {
			const statusText = statusBadge.textContent.toLowerCase().trim();
			statusMatch = statusText.includes(statusValue.toLowerCase());
		}

		if (currencyValue !== 'all' && currencyBadge) {
			const currencyText = currencyBadge.textContent.trim();
			currencyMatch = currencyText.includes(currencyValue);
		}

		if (searchMatch && statusMatch && currencyMatch) {
			row.style.display = '';
			visibleCount++;
		} else {
			row.style.display = 'none';
		}
	}

	// Show/hide empty state
	const emptyState = document.getElementById('emptyState');
	const paginationWrapper = document.getElementById('paginationWrapper');

	if (visibleCount === 0) {
		tbody.parentElement.style.display = 'none';
		emptyState.style.display = 'block';
		paginationWrapper.style.display = 'none';
	} else {
		tbody.parentElement.style.display = 'table';
		emptyState.style.display = 'none';
		paginationWrapper.style.display = 'flex';
	}

	// Update pagination info
	document.getElementById('showingEnd').textContent = visibleCount;
	document.getElementById('totalRecords').textContent = visibleCount;
}

function resetFilters() {
	document.getElementById('searchInput').value = '';
	document.getElementById('statusFilter').value = 'all';
	document.getElementById('currencyFilter').value = 'all';
	applyFilters();
}

// Optional: Apply filters on Enter key
document.getElementById('searchInput').addEventListener('keyup', function(e) {
	if (e.key === 'Enter') {
		applyFilters();
	}
});
</script>
{% endblock %}
