{%extends "account/base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Change Password | Norvia.io{% endblock %}

{% block body_class %}page-changepwd{% endblock %}

{% block content %}
<div class="content-body default-height">
	<div class="container-fluid">
		<!-- Breadcrumb -->
		<div class="row">
			<div class="col-xl-12">
				<div class="page-titles">
					<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="{% url 'home' %}">Dashboard</a></li>
							<li class="breadcrumb-item"><a href="{% url 'settings' %}">Settings</a></li>
							<li class="breadcrumb-item active" aria-current="page">Change Password</li>
						</ol>
					</nav>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xl-12">
				<div class="password-container">
					<!-- Password Header -->
					<div class="password-header">
						<div class="password-header-content">
							<i class="material-icons" style="font-size: 56px; margin-bottom: 15px;">vpn_key</i>
							<h1>Change Password</h1>
							<p>Create a strong, unique password to protect your account</p>
						</div>
					</div>

					<!-- Security Notice -->
					<div class="info-box-password">
						<i class="material-icons">info</i>
						<p><strong>Security Tip:</strong> Use a strong password that you don't use anywhere else. Consider using a password manager to generate and store secure passwords.</p>
					</div>

					<!-- Password Change Form -->
					<div class="password-card">
						<form id="changePasswordForm" method="post">
							{% csrf_token %}
							<!-- Current Password -->
							<div class="form-group-password">
								<label class="form-label-password" for="currentPassword">Current Password *</label>
								<div class="password-input-wrapper">
									<input type="password" class="form-input-password" id="currentPassword" placeholder="Enter your current password" required name="currentPassword">
									<button type="button" class="password-toggle">
										<i class="material-icons">visibility_off</i>
									</button>
								</div>
							</div>

							<!-- New Password -->
							<div class="form-group-password">
								<label class="form-label-password" for="newPassword">New Password *</label>
								<div class="password-input-wrapper">
									<input type="password" class="form-input-password" id="newPassword" placeholder="Enter your new password" required oninput="checkPasswordStrength()" name="newPassword">
									<button type="button" class="password-toggle">
										<i class="material-icons">visibility_off</i>
									</button>
								</div>

								<!-- Password Strength Meter -->
								<div class="password-strength-container" id="strengthContainer" style="display: none;">
									<div class="password-strength-bar">
										<div class="password-strength-fill" id="strengthBar"></div>
									</div>
									<div class="password-strength-text" id="strengthText">
										<i class="material-icons">info</i>
										<span>Password strength: <span id="strengthLabel">Weak</span></span>
									</div>
								</div>
							</div>

							<!-- Password Requirements -->
							<div class="password-requirements">
								<div class="password-requirements-title">
									<i class="material-icons">checklist</i>
									Password Requirements
								</div>
								<div class="requirement-item" id="req-length">
									<i class="material-icons">radio_button_unchecked</i>
									<span>At least 8 characters long</span>
								</div>
								<div class="requirement-item" id="req-uppercase">
									<i class="material-icons">radio_button_unchecked</i>
									<span>Contains at least one uppercase letter (A-Z)</span>
								</div>
								<div class="requirement-item" id="req-lowercase">
									<i class="material-icons">radio_button_unchecked</i>
									<span>Contains at least one lowercase letter (a-z)</span>
								</div>
								<div class="requirement-item" id="req-number">
									<i class="material-icons">radio_button_unchecked</i>
									<span>Contains at least one number (0-9)</span>
								</div>
								<div class="requirement-item" id="req-special">
									<i class="material-icons">radio_button_unchecked</i>
									<span>Contains at least one special character (!@#$%^&*)</span>
								</div>
							</div>

							<!-- Confirm New Password -->
							<div class="form-group-password">
								<label class="form-label-password" for="confirmPassword">Confirm New Password *</label>
								<div class="password-input-wrapper">
									<input type="password" class="form-input-password" id="confirmPassword" placeholder="Re-enter your new password" required name="confirmPassword">
									<button type="button" class="password-toggle">
										<i class="material-icons">visibility_off</i>
									</button>
								</div>
							</div>

							<!-- Warning Box -->
							<div class="warning-box-password">
								<i class="material-icons">warning</i>
								<p><strong>Important:</strong> After changing your password, you will be logged out from all devices and need to log in again with your new password.</p>
							</div>

							<!-- Submit Button -->
							<button type="submit" class="btn-password" id="submitBtn">
								<i class="material-icons">check_circle</i>
								Change Password
							</button>

							<button type="button" class="btn-cancel" >
								Cancel
							</button>
						</form>
					</div>

					<!-- Password History -->
					<div class="password-history">
						<h3 class="password-history-title">
							<i class="material-icons">history</i>
							Password History
						</h3>
						<p class="password-history-subtitle">Track your password changes for security purposes</p>
					
						{% if history %}
							{% for item in history %}
								<div class="history-item">
									<span class="history-label">Changed</span>
									<span class="history-value">
										{{ item.changed_at|naturaltime }} 
										({{ item.changed_at|date:"F j, Y" }})
									</span>
								</div>
							{% endfor %}
						{% else %}
							<p>No password changes recorded yet.</p>
						{% endif %}
					</div>					

				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

