{% extends "account/base.html" %}
{% load static %}
{% load humanize %}

{% block page_css %}
<link href="{% static 'vendor/bootstrap-select/dist/css/bootstrap-select.min.css' %}" rel="stylesheet">
{% endblock %}

{% block page_scripts %}
<!-- Bootstrap Select -->
<script src="{% static 'vendor/bootstrap-select/dist/js/bootstrap-select.min.js' %}"></script>
<!-- Dashboard JavaScript -->
<script src="{% static 'js/dashboard.js' %}"></script>
<!-- Alert Display JavaScript -->
<script src="{% static 'js/alert-display.js' %}"></script>

<!-- Transfer Modal Functions -->
<script>
	// Transfer Modal Functions
	let currentFromWallet = 'trading';
	let currentToWallet = 'holding';

	// Swap wallets function
	function swapWallets() {
		// Swap the wallet values
		const temp = currentFromWallet;
		currentFromWallet = currentToWallet;
		currentToWallet = temp;

		// Update display
		updateWalletDisplay();
	}

	// Update wallet display
	function updateWalletDisplay() {
		const fromDisplay = document.getElementById('fromWalletDisplay');
		const toDisplay = document.getElementById('toWalletDisplay');

		fromDisplay.textContent = currentFromWallet === 'trading' ? 'Trading Wallet' : 'Holding Wallet';
		toDisplay.textContent = currentToWallet === 'trading' ? 'Trading Wallet' : 'Holding Wallet';

		// Update available balance
		updateAvailableBalance();
	}

	// Set max amount function
	function setMaxAmount() {
		const maxBalance = walletData[currentFromWallet].deposit.usd;
		document.getElementById('transferAmount').value = maxBalance.toFixed(2);
	}

	// Update available balance
	function updateAvailableBalance() {
		const balance = walletData[currentFromWallet].deposit.usd.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
		document.getElementById('availableBalance').textContent = balance;
	}

	// Show success alert
	function showTransferSuccess() {
		// Django will handle showing success messages
		alert('Transfer successful!');
	}

	function processTransfer() {
		const amount = parseFloat(document.getElementById('transferAmount').value);

		if (isNaN(amount) || amount <= 0) {
			alert('Please enter a valid amount');
			return;
		}

		const fromBalance = walletData[currentFromWallet].deposit.usd;
		if (amount > fromBalance) {
			alert('Insufficient balance');
			return;
		}

		// Django will handle the actual transfer
		// Close modal
		const modal = bootstrap.Modal.getInstance(document.getElementById('transferModal'));
		modal.hide();

		// Show success alert
		showTransferSuccess();

		// Reset form
		document.getElementById('transferAmount').value = '';
	}

	// Reset to default when modal opens
	document.getElementById('transferModal')?.addEventListener('show.bs.modal', function() {
		currentFromWallet = 'trading';
		currentToWallet = 'holding';
		updateWalletDisplay();
		document.getElementById('transferAmount').value = '';
	});
</script>
{% endblock %}

{% block content %}
        <div class="content-body default-height">
            <!-- row -->
			<div class="container-fluid">
				<!-- Row -->
				<div class="row">
					<div class="col-xl-12">
						<div class="row">
							<div class="col-xl-12">
								<div class="page-titles">
									<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
										<ol class="breadcrumb">
										  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
										</ol>
									  </nav>
								</div>
							</div>
						</div>

						<!-- Custom CSS for Copy Trading Dashboard -->
						

						<!-- Transfer Success Alert -->
						<div id="transferSuccessAlert" class="alert alert-success transfer-success-alert" style="display: none;">
							<i class="material-icons me-2">check_circle</i>
							<span>Transfer successful!</span>
						</div>

						<!-- Notification Banners -->
						<div class="row">
							<div class="col-xl-12">
								<!-- KYC Notification -->
								<!-- TODO: Django backend should pass 'show_kyc_notification' context variable -->
								<!-- Example in views.py: context['show_kyc_notification'] = not request.user.kyc_verified -->
								 {% if not request.user.verified_kyc %}
								<div id="kycNotification" class="alert-banner kyc-banner" data-show>
									<div class="alert-banner-content">
										<div class="alert-banner-icon">
											<i class="material-icons">info</i>
										</div>
										<div class="alert-banner-text">
											<strong>Complete Your KYC Verification</strong>
											<p>Please verify your identity to unlock all features and increase your withdrawal limits.</p>
										</div>
										<a href="{% url 'kyc_verification' %}" class="alert-banner-action">
											Verify Now
										</a>
										<button class="alert-banner-close" onclick="dismissNotification('kyc')">
											<i class="material-icons">close</i>
										</button>
									</div>
								</div>
								{% endif %}

								<!-- Admin Notification -->
								{% for notif in notifications %}
								<div class="alert-banner admin-banner">
									<div class="alert-banner-content">
										<div class="alert-banner-icon">
											<i class="material-icons">{{ notif.icon }}</i>
										</div>
										<div class="alert-banner-text">
											<strong>{{ notif.title }}</strong>
											<p>{{ notif.message }}</p>
										</div>
										<button class="alert-banner-close" onclick="dismissNotification({{ notif.id }})">
											<i class="material-icons">close</i>
										</button>
									</div>
								</div>
								{% endfor %}
								
							</div>
						</div>

						<!-- Swipeable Wallet Cards -->
						<div class="row">
							<div class="col-xl-12">
								<div class="wallet-swiper-container wow fadeInUp" data-wow-delay="0.3s">
									<div class="swiper wallet-swiper">
										<div class="swiper-wrapper">
											<!-- Trading Wallet Slide -->
											<div class="swiper-slide">
												<div class="wallet-slide trading">
													<div class="wallet-content">
														<div class="wallet-header-row">
															<div class="wallet-title-section">
																<div class="wallet-name">Trading Wallet</div>
															</div>
															<div class="balance-toggle-group">
																<button class="balance-toggle-btn active" id="tradingDepositBtn" onclick="showTradingBalance('deposit')">
																	Deposit
																</button>
																<button class="balance-toggle-btn" id="tradingTradingBtn" onclick="showTradingBalance('trading')">
																	Profit
																</button>
															</div>
														</div>

														<div class="balance-row">
															<div class="balance-number" id="tradingBalanceDisplay" data-deposit-usd="${{request.user.profit|intcomma}}" data-trading-usd="${{request.user.deposit|intcomma}}">${{request.user.profit|intcomma}}</div>
															<button class="visibility-toggle-btn" onclick="toggleTradingBalance()">
																<i class="material-icons" id="tradingEyeIcon">visibility_off</i>
															</button>
														</div>

														<div class="btc-equiv" id="tradingBtcDisplay">
															≈ <span id="tradingBtcValue" data-deposit-btc="0.0832" data-trading-btc="0.0192">0.0832</span> BTC
														</div>

														<div class="swipe-hint">
															<i class="material-icons">swipe</i>
															<span>Swipe to see Holding Wallet</span>
														</div>
													</div>
												</div>
											</div>

											<!-- Holding Wallet Slide -->
											<div class="swiper-slide">
												<div class="wallet-slide holding">
													<div class="wallet-content">
														<div class="wallet-header-row">
															<div class="wallet-title-section">
																<div class="wallet-name">Holding Wallet</div>
															</div>
															<div class="balance-toggle-group">
																<button class="balance-toggle-btn active" id="holdingDepositBtn" onclick="showHoldingBalance('deposit')">
																	Deposit
																</button>
																<button class="balance-toggle-btn" id="holdingTradingBtn" onclick="showHoldingBalance('trading')">
																	Profit
																</button>
															</div>
														</div>

														<div class="balance-row">
															<div class="balance-number" id="holdingBalanceDisplay" data-deposit-usd="${{request.user.holding_profit|intcomma}}" data-trading-usd="${{request.user.holding_deposit|intcomma}}">${{request.user.holding_profit|intcomma}}</div>
															<button class="visibility-toggle-btn" onclick="toggleHoldingBalance()">
																<i class="material-icons" id="holdingEyeIcon">visibility_off</i>
															</button>
														</div>

														<div class="btc-equiv" id="holdingBtcDisplay">
															≈ <span id="holdingBtcValue" data-deposit-btc="0.0279" data-trading-btc="0.0052">0.0279</span> BTC
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="swiper-pagination"></div>
									</div>

									<!-- Action Buttons Below Wallet (4 Column Grid - Bybit Style) -->
									<div class="action-buttons-row" style="margin-top: 20px;">
										<button class="action-button" onclick="window.location.href='{% url 'deposit' %}'">
											<div class="action-icon">
												<i class="material-icons">add_circle</i>
											</div>
											<span>Deposit</span>
										</button>
										<button class="action-button" onclick="window.location.href='{% url 'withdraw' %}'">
											<div class="action-icon">
												<i class="material-icons">remove_circle</i>
											</div>
											<span>Withdraw</span>
										</button>
										<button class="action-button" data-bs-toggle="modal" data-bs-target="#transferModal">
											<div class="action-icon">
												<i class="material-icons">swap_horiz</i>
											</div>
											<span>Transfer</span>
										</button>
										<button class="action-button" onclick="window.location.href='{% url 'copy_trader' %}'">
											<div class="action-icon">
												<i class="material-icons">group_add</i>
											</div>
											<span>Copy Traders</span>
										</button>
									</div>
								</div>
							</div>
						</div>

						<!-- Performance Overview -->
						<div class="row">
							<!-- P&L Card - Profit Example -->
							<div class="col-xl-6">
								<div class="card wow fadeInUp" data-wow-delay="0.6s">
									<div class="card-body" style="padding: 20px;">
										<div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
											<div style="background: #dcfce7; width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
												<i class="material-icons" style="color: #16a34a; font-size: 24px;">trending_up</i>
											</div>
											<div>
												<div style="color: #6c757d; font-size: 13px; margin-bottom: 2px;">24h P&L (Profit)</div>
												<div style="color: #16a34a; font-size: 22px; font-weight: 800; line-height: 1;">+$248.75</div>
											</div>
										</div>
										<div style="color: #6c757d; font-size: 12px;">+4.58% from yesterday</div>
									</div>
								</div>
							</div>

							<!-- P&L Card - Loss Example -->
							<div class="col-xl-6">
								<div class="card wow fadeInUp" data-wow-delay="0.7s">
									<div class="card-body" style="padding: 20px;">
										<div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
											<div style="background: #fee2e2; width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
												<i class="material-icons" style="color: #dc2626; font-size: 24px;">trending_down</i>
											</div>
											<div>
												<div style="color: #6c757d; font-size: 13px; margin-bottom: 2px;">24h P&L (Loss)</div>
												<div style="color: #dc2626; font-size: 22px; font-weight: 800; line-height: 1;">-$182.40</div>
											</div>
										</div>
										<div style="color: #6c757d; font-size: 12px;">-3.27% from yesterday</div>
									</div>
								</div>
							</div>
						</div>

						<!--
							Signal Strength Indicators

							DEVELOPER NOTE: Both states are shown side-by-side for reference.
							In production, show ONLY ONE based on user's plan status:
							- LEFT (Gray Dashed): User has NO signal plan
							- RIGHT (Green): User HAS PAID for signal plan (no upgrade button/badge shown)
						-->
						<div class="row">
							<div class="col-xl-6">
								<!-- Inactive State (No Plan) -->
								{% if not request.user.current_plan %}
								<div class="signal-strength-compact signal-inactive">
									<div class="signal-icon-compact">
										<i class="material-icons">signal_cellular_off</i>
									</div>
									<div class="signal-info-compact">
										<div class="signal-label-compact">Signal Strength</div>
										<div class="signal-value-compact">No Active Plan</div>
									</div>
									<div class="signal-action-compact">
										<button class="signal-btn-compact" onclick="window.location.href='{% url 'planning' %}'">
											<i class="material-icons">add_circle</i>
											<span>Get Plan</span>
										</button>
									</div>
								</div>
								{% else %}
								<div class="signal-strength-compact signal-active">
									<div class="signal-icon-compact">
										<i class="material-icons">signal_cellular_off</i>
									</div>
									<div class="signal-info-compact">
										<div class="signal-label-compact">Signal Strength</div>
										<div class="signal-value-compact">Active Plan</div>
									</div>
								</div>
								{% endif %}
							</div>
							<div class="col-xl-6">
								<!-- Active State (User Paid - No Upgrade Button, No Badge) -->
								<div class="signal-strength-compact signal-active">
									<div class="signal-icon-compact">
										<i class="material-icons">trending_up</i>
									</div>
									<div class="signal-info-compact">
										{% if not request.user.current_plan %}
										<div class="signal-label-compact">Signal Strength Active</div>
										<div class="signal-value-compact">+25% Boost</div>
										{% else %}
										<div class="signal-label-compact">Plan</div>
										<div class="signal-value-compact">{{request.user.current_plan.category.name}}-{{request.user.current_plan.tier}}</div>
										{% endif %}
									</div>
								</div>
							</div>
						</div>

						<!-- Copy Trading Circle Countdown -->
						<div class="row" id="copyTradingCircleRow">
							<div class="col-xl-12 wow fadeInUp" data-wow-delay="0.8s">
								<div class="card" style="background: linear-gradient(135deg, #01A3FF 0%, #0284c7 100%); border: none; overflow: hidden; position: relative;">
									<!-- Close Button -->
									<button onclick="dismissTradingCircle()" style="position: absolute; top: 6px; right: 6px; background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
										<i class="material-icons" style="font-size: 16px;">close</i>
									</button>
									<div class="card-body" style="padding: 10px 14px;">
										<div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
											<div style="color: white; flex: 1; min-width: 150px;">
												<div style="display: flex; align-items: center; gap: 5px;">
													<i class="material-icons" style="font-size: 18px; color: white;">schedule</i>
													<h3 style="font-size: 13px; font-weight: 700; margin: 0; color: white;">Trading Circle</h3>
												</div>
											</div>
											<div style="display: flex; gap: 6px; flex-wrap: wrap; justify-content: center;">
												<!-- Days -->
												<div style="text-align: center; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 6px 8px; border-radius: 6px; min-width: 42px;">
													<div style="font-size: 16px; font-weight: 700; color: white; line-height: 1;" id="circle-days">--</div>
													<div style="font-size: 8px; color: white; margin-top: 2px; font-weight: 600; opacity: 0.85;">DAYS</div>
												</div>
												<!-- Hours -->
												<div style="text-align: center; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 6px 8px; border-radius: 6px; min-width: 42px;">
													<div style="font-size: 16px; font-weight: 700; color: white; line-height: 1;" id="circle-hours">--</div>
													<div style="font-size: 8px; color: white; margin-top: 2px; font-weight: 600; opacity: 0.85;">HRS</div>
												</div>
												<!-- Minutes -->
												<div style="text-align: center; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 6px 8px; border-radius: 6px; min-width: 42px;">
													<div style="font-size: 16px; font-weight: 700; color: white; line-height: 1;" id="circle-minutes">--</div>
													<div style="font-size: 8px; color: white; margin-top: 2px; font-weight: 600; opacity: 0.85;">MIN</div>
												</div>
												<!-- Seconds -->
												<div style="text-align: center; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 6px 8px; border-radius: 6px; min-width: 42px;">
													<div style="font-size: 16px; font-weight: 700; color: white; line-height: 1;" id="circle-seconds">--</div>
													<div style="font-size: 8px; color: white; margin-top: 2px; font-weight: 600; opacity: 0.85;">SEC</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Decorative elements -->
									<div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; filter: blur(40px);"></div>
									<div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; filter: blur(30px);"></div>
								</div>
							</div>
						</div>

						<!-- Market Overview Chart -->
						<div class="row">
							<div class="col-xl-12 wow fadeInUp" data-wow-delay="0.9s">
								<div class="card market_chart">
									<div class="card-header border-0 align-items-start flex-wrap pb-0">
										<div>
											<h2 class="card-title mb-2" style="font-size: 18px; font-weight: 700;">Market Overview</h2>
											<div class="market-data">
												<div class="income data">
													<p class="mb-0">Market Cap</p>
													<h4 id="market-cap">Loading...</h4>
												</div>
												<div class="price data">
													<p class="mb-0">BTC Price</p>
													<h4 id="btc-price">Loading...</h4>
												</div>
												<div class="rate data">
													<p class="mb-0">24h Change</p>
													<h4 id="btc-change">Loading...</h4>
												</div>
												<div class="volume data">
													<p class="mb-0">24h Volume</p>
													<h4 id="btc-volume">Loading...</h4>
												</div>
											</div>
										</div>
										<div class="d-flex align-items-center flex-wrap gap-2">
											<!-- Date Range Selector -->
											<div class="btn-group date-range-selector me-3" role="group">
												<button type="button" class="btn btn-sm date-range-btn" data-days="7">7D</button>
												<button type="button" class="btn btn-sm date-range-btn" data-days="14">14D</button>
												<button type="button" class="btn btn-sm date-range-btn active" data-days="30">1M</button>
												<button type="button" class="btn btn-sm date-range-btn" data-days="90">3M</button>
												<button type="button" class="btn btn-sm date-range-btn" data-days="365">1Y</button>
											</div>

											<!-- Crypto Selector -->
											<select class="image-select default-select dashboard-select" aria-label="Default" id="crypto-selector">
												<option value="bitcoin" selected>Bitcoin (BTC)</option>
												<option value="ethereum">Ethereum (ETH)</option>
												<option value="binancecoin">Binance Coin (BNB)</option>
												<option value="solana">Solana (SOL)</option>
												<option value="ripple">Ripple (XRP)</option>
											</select>
										</div>
									</div>
									<div class="card-body custome-tooltip pt-0 px-3">
										<div id="activity1"></div>
									</div>
								</div>
							</div>
						</div>

						<!-- Trades Section with Tabs -->
						<div class="row">
							<div class="col-xl-12">
								<div class="card wow fadeInUp" data-wow-delay="0.9s">
									<div class="card-header border-0 pb-0">
										<div class="d-flex justify-content-between align-items-center w-100">
											<h4 class="card-title mb-0" style="font-size: 18px; font-weight: 700;">My Trades</h4>
											<a href="#" class="view-all-link">
												View All
												<i class="material-icons" style="font-size: 16px;">arrow_forward</i>
											</a>
										</div>
									</div>
									<div class="card-body" style="padding: 20px 20px 10px;">
										<!-- Tabs Navigation -->
										<ul class="nav nav-tabs trade-tabs" role="tablist">
											<li class="nav-item" role="presentation">
												<button class="nav-link active" id="open-trades-tab" data-bs-toggle="tab" data-bs-target="#open-trades" type="button" role="tab">
													<i class="material-icons">hourglass_top</i>
													<span>Open Trades</span>
												</button>
											</li>
											<li class="nav-item" role="presentation">
												<button class="nav-link" id="closed-trades-tab" data-bs-toggle="tab" data-bs-target="#closed-trades" type="button" role="tab">
													<i class="material-icons">hourglass_bottom</i>
													<span>Closed Trades</span>
												</button>
											</li>
										</ul>

										<!-- Tabs Content -->
										<div class="tab-content" style="margin-top: 20px;">

											<!-- Open Trades -->
											<div class="tab-pane fade show active" id="open-trades" role="tabpanel">
										
												{% for trade in open_trades %}
												<div class="trade-card {% if trade.pnl >= 0 %}profit{% else %}loss{% endif %}">
													<div class="trade-header">
														<div class="trade-pair">{{ trade.symbol|upper }}</div>
														<div class="trade-status active">Active</div>
													</div>
										
													<div class="trade-info">
														<span>Entry: ${{ trade.entry_price }}</span>
														<span>Current: ${{ trade.current_price }}</span>
													</div>
										
													<div class="trade-info">
														<span>Type: {{ trade.trade_type|title }}</span>
														<span>Size: {{ trade.size }}</span>
													</div>
										
													<div class="trade-pnl {% if trade.pnl >= 0 %}profit{% else %}loss{% endif %}">
														{% if trade.pnl >= 0 %}+{% endif %}${{ trade.pnl }} 
														({% if trade.pnl_percent >= 0 %}+{% endif %}{{ trade.pnl_percent }}%)
													</div>
												</div>
												{% empty %}
												<p>No open trades available.</p>
												{% endfor %}
										
											</div>
										
											<!-- Closed Trades -->
											<div class="tab-pane fade" id="closed-trades" role="tabpanel">
										
												{% for trade in closed_trades %}
												<div class="trade-card {% if trade.pnl >= 0 %}profit{% else %}loss{% endif %}">
													<div class="trade-header">
														<div class="trade-pair">{{ trade.symbol|upper }}</div>
														<div class="trade-status">Closed</div>
													</div>
										
													<div class="trade-info">
														<span>Entry: ${{ trade.entry_price }}</span>
														<span>Exit: ${{ trade.current_price }}</span>
													</div>
										
													<div class="trade-info">
														<span>Type: {{ trade.trade_type|title }}</span>
														<span>{{ trade.closed_at|timesince }} ago</span>
													</div>
										
													<div class="trade-pnl {% if trade.pnl >= 0 %}profit{% else %}loss{% endif %}">
														{% if trade.pnl >= 0 %}+{% endif %}${{ trade.pnl }}
														({% if trade.pnl_percent >= 0 %}+{% endif %}{{ trade.pnl_percent }}%)
													</div>
												</div>
												{% empty %}
												<p>No closed trades yet.</p>
												{% endfor %}
										
											</div>
										</div>
										
									</div>
								</div>
							</div>
						</div>


						<!-- Copy Trading Dashboard Sections -->
						<div class="row">
							<div class="col-xl-12 wow fadeInUp" data-wow-delay="0.7s">
								<div class="card">
									<div class="card-header border-0">
										<h4 class="card-title">Copied Traders Performance</h4>
									</div>
									<div class="card-body">
										<div class="table-responsive">
											<table class="table table-hover">
												<thead>
													<tr>
														<th>Trader</th>
														<th>Win Rate</th>
														<th>Profit Share</th>
														<th>24h P&L</th>
														<th>Total Profit</th>
														<th>Action</th>
													</tr>
												</thead>
											
												<tbody>
													{% for t in traders %}
													<tr>
														<!-- Trader Info -->
														<td>
															<div class="d-flex align-items-center">
																<img src="{{ t.trader.image.url }}" 
																	 class="rounded-circle me-2" width="40" height="40" alt="">
																<div>
																	<h6 class="mb-0">{{ t.trader.full_name }}</h6>
																	<small class="text-muted">@{{ t.trader.username }}</small>
																</div>
															</div>
														</td>
											
														<!-- Win Rate -->
														<td>
															<span class="badge {% if t.trader.win_rate >= 50 %}badge-success{% else %}badge-danger{% endif %}">
																{{ t.trader.win_rate }}%
															</span>
														</td>
											
														<!-- Profit Share from Trader Model -->
														<td>{{ t.trader.profit_share }}%</td>
											
														<!-- Last 24h PNL -->
														<td class="{% if t.last_24h_profit_loss >= 0 %}text-success{% else %}text-danger{% endif %}">
															{% if t.last_24h_profit_loss >= 0 %}+{% endif %}
															${{ t.last_24h_profit_loss }}
														</td>
											
														<!-- Total Profit -->
														<td class="{% if t.total_profit >= 0 %}text-success{% else %}text-danger{% endif %}">
															{% if t.total_profit >= 0 %}+{% endif %}
															${{ t.total_profit }}
														</td>
											
														<!-- Action -->
														<td>
															<form method="POST" action="{% url 'stop_copying' t.ref %}">
																{% csrf_token %}
																<button class="btn btn-danger btn-sm" type="submit">Stop Copying</button>
															</form>
														</td>
													</tr>
											
													{% empty %}
													<tr>
														<td colspan="6" class="text-center text-muted py-3">
															You are not copying any trader yet.
														</td>
													</tr>
													{% endfor %}
												</tbody>
											</table>
											
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- End Traders Table -->

					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Transfer Modal -->
	<div class="modal fade" id="transferModal" tabindex="-1" aria-labelledby="transferModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content transfer-modal">
				<div class="modal-header border-0 pb-0">
					<h5 class="modal-title fw-bold" id="transferModalLabel">Transfer</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body px-3 pb-3">
					<form id="transferForm">
						<!-- From Account Section -->
						<div class="transfer-section mb-1">
							<label class="transfer-label">From</label>
							<div class="transfer-display-wrapper">
								<div class="transfer-wallet-name" id="fromWalletDisplay">Trading Wallet</div>
							</div>
						</div>

						<!-- Swap Button -->
						<div class="text-center" style="margin: 8px 0;">
							<button type="button" class="swap-button" onclick="swapWallets()">
								<i class="material-icons">swap_vert</i>
							</button>
						</div>

						<!-- To Account Section -->
						<div class="transfer-section mb-3">
							<label class="transfer-label">To</label>
							<div class="transfer-display-wrapper">
								<div class="transfer-wallet-name" id="toWalletDisplay">Holding Wallet</div>
							</div>
						</div>

						<!-- Coin Section -->
						<div class="transfer-section mb-2">
							<label class="transfer-label">Coin</label>
							<div class="coin-select-wrapper">
								<div class="coin-display">
									<span class="coin-symbol">$</span>
									<span class="coin-name">USD</span>
								</div>
								<i class="material-icons">chevron_right</i>
							</div>
						</div>

						<!-- Amount Section -->
						<div class="transfer-section mb-2">
							<label class="transfer-label">Amount</label>
							<div class="amount-input-wrapper">
								<input type="number" class="amount-input" id="transferAmount" placeholder="Please enter" min="0" step="0.01">
								<button type="button" class="max-button" onclick="setMaxAmount()">Max</button>
								<span class="currency-label">USD</span>
							</div>
						</div>

						<!-- Available Balance -->
						<div class="available-balance">
							<span class="available-label">Available</span>
							<span class="available-amount">
								<span id="availableBalance">5,430.50</span> USD
								<i class="material-icons available-info">help_outline</i>
							</span>
						</div>
					</form>
				</div>
				<div class="modal-footer border-0 pt-0 px-3 pb-3">
					<button type="button" class="btn btn-transfer w-100" onclick="processTransfer()">
						Confirm Transfer
					</button>
				</div>
			</div>
		</div>
	</div>

{% endblock %}
