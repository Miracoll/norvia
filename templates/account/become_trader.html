{%extends "account/base.html" %}
{% load static %}

{% block title %}Become a Trader{% endblock %}

{% block body_class %}page-becometrader{% endblock %}

{% block content %}
<div class="content-body default-height">
	<div class="container-fluid">
		<!-- Breadcrumb -->
		<div class="row">
			<div class="col-xl-12">
				<div class="page-titles">
					<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="{% url 'home' %}">Dashboard</a></li>
							<li class="breadcrumb-item"><a href="{% url 'copy_trader' %}">Copy Trading</a></li>
							<li class="breadcrumb-item active" aria-current="page">Become a Trader</li>
						</ol>
					</nav>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xl-12">
				<div class="application-container">
					<!-- Header -->
					<div class="application-header">
						<i class="material-icons" style="font-size: 60px; margin-bottom: 15px;">star</i>
						<h1>Become a Copy Trading Leader</h1>
						<p>Share your trading expertise and earn additional income by allowing others to copy your trades</p>
					</div>

					<!-- Benefits Section -->
					<div class="benefits-section">
						<h2>Why Become a Trader?</h2>
						<p>Join our elite community of professional traders</p>
					
						<div class="benefits-grid">
							{% for item in benefits %}
								<div class="benefit-card">
									<i class="material-icons">{{ item.icon }}</i>
									<h4>{{ item.title }}</h4>
									<p>{{ item.description }}</p>
								</div>
							{% endfor %}
						</div>
					</div>					

					<!-- Application Form -->
					<div class="application-form-section">
						<h2 style="font-size: 24px; font-weight: 700; margin-bottom: 30px;">Trader Application Form</h2>

						<!-- Step Indicator -->
						<div class="step-indicator">
							<div class="step active" data-step="1">
								<div class="step-number">1</div>
								<div class="step-label">Personal Info</div>
							</div>
							<div class="step" data-step="2">
								<div class="step-number">2</div>
								<div class="step-label">Trading Experience</div>
							</div>
							<div class="step" data-step="3">
								<div class="step-number">3</div>
								<div class="step-label">Strategy & Style</div>
							</div>
							<div class="step" data-step="4">
								<div class="step-number">4</div>
								<div class="step-label">Verification</div>
							</div>
							<div class="step" data-step="5">
								<div class="step-number">5</div>
								<div class="step-label">Review</div>
							</div>
						</div>

						<!-- Form Steps -->
						<form id="traderApplicationForm" method="post" action="{% url 'become_trader' %}" enctype="multipart/form-data">
							{% csrf_token %}
							<!-- Step 1: Personal Information -->
							<div class="form-step active" data-step="1">
								<h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Personal Information</h3>

								<div class="form-group">
									<label class="form-label">Full Name <span class="required">*</span></label>
									<input type="text" class="form-control" id="fullName" placeholder="Enter your full name" name="fullName" value="{{request.user.first_name}} {{request.user.last_name}}" required>
									<div class="error-message">Please enter your full name</div>
								</div>

								<div class="form-group">
									<label class="form-label">Email Address <span class="required">*</span></label>
									<input type="email" class="form-control" id="email" placeholder="your.email@example.com" name="email" value="{{request.user.email}}" required>
									<div class="error-message">Please enter a valid email address</div>
								</div>

								<div class="form-group">
									<label class="form-label">Phone Number <span class="required">*</span></label>
									<input type="tel" class="form-control" id="phone" placeholder="+1 (555) 000-0000" name="phone" required>
									<div class="error-message">Please enter your phone number</div>
								</div>

								<div class="form-group">
									<label class="form-label">Country of Residence <span class="required">*</span></label>
									<select class="form-select" id="country" required name="country">
										<option value="">Select country</option>
										<option value="US">United States</option>
										<option value="UK">United Kingdom</option>
										<option value="CA">Canada</option>
										<option value="AU">Australia</option>
										<option value="DE">Germany</option>
										<option value="FR">France</option>
										<option value="IN">India</option>
										<option value="CN">China</option>
										<option value="JP">Japan</option>
										<option value="BR">Brazil</option>
										<option value="MX">Mexico</option>
										<option value="Other">Other</option>
									</select>
									<div class="error-message">Please select your country</div>
								</div>
							</div>

							<!-- Step 2: Trading Experience -->
							<div class="form-step" data-step="2">
								<h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Trading Experience</h3>

								<div class="form-group">
									<label class="form-label">Years of Trading Experience <span class="required">*</span></label>
									<select class="form-select" id="experience" required name="experience">
										<option value="">Select experience level</option>
										<option value="1">Less than 1 year</option>
										<option value="2">1-2 years</option>
										<option value="3">3-5 years</option>
										<option value="5">5-10 years</option>
										<option value="10">More than 10 years</option>
									</select>
									<div class="error-message">Please select your experience level</div>
								</div>

								<div class="form-group">
									<label class="form-label">Primary Trading Markets <span class="required">*</span></label>
									<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
										<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
											<input type="checkbox" name="markets" value="crypto" style="width: 18px; height: 18px;">
											<span>Cryptocurrency</span>
										</label>
										<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
											<input type="checkbox" name="markets" value="stocks" style="width: 18px; height: 18px;">
											<span>Stocks</span>
										</label>
										<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
											<input type="checkbox" name="markets" value="forex" style="width: 18px; height: 18px;">
											<span>Forex</span>
										</label>
										<label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
											<input type="checkbox" name="markets" value="commodities" style="width: 18px; height: 18px;">
											<span>Commodities</span>
										</label>
									</div>
									<div class="error-message">Please select at least one market</div>
								</div>

								<div class="form-group">
									<label class="form-label">Average Monthly Trading Volume (USD) <span class="required">*</span></label>
									<select class="form-select" id="volume" required name="volume">
										<option value="">Select trading volume</option>
										<option value="1">Less than $10,000</option>
										<option value="2">$10,000 - $50,000</option>
										<option value="3">$50,000 - $100,000</option>
										<option value="4">$100,000 - $500,000</option>
										<option value="5">More than $500,000</option>
									</select>
									<div class="error-message">Please select your average trading volume</div>
								</div>

								<div class="form-group">
									<label class="form-label">Do you have any professional trading certifications?</label>
									<textarea class="form-control" id="certifications" placeholder="List any relevant certifications (e.g., CFA, CFTe, CMT, etc.)" name="certifications"></textarea>
								</div>
							</div>

							<!-- Step 3: Strategy & Style -->
							<div class="form-step" data-step="3">
								<h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Trading Strategy & Style</h3>

								<div class="form-group">
									<label class="form-label">Trading Style <span class="required">*</span></label>
									<select class="form-select" id="tradingStyle" required name="tradingStyle">
										<option value="">Select trading style</option>
										<option value="scalping">Scalping (Very Short-term)</option>
										<option value="day">Day Trading</option>
										<option value="swing">Swing Trading</option>
										<option value="position">Position Trading (Long-term)</option>
										<option value="algorithmic">Algorithmic Trading</option>
									</select>
									<div class="error-message">Please select your trading style</div>
								</div>

								<div class="form-group">
									<label class="form-label">Risk Management Approach <span class="required">*</span></label>
									<select class="form-select" id="riskLevel" required name="riskLevel">
										<option value="">Select risk level</option>
										<option value="conservative">Conservative (Low Risk)</option>
										<option value="moderate">Moderate (Medium Risk)</option>
										<option value="aggressive">Aggressive (High Risk)</option>
									</select>
									<div class="error-message">Please select your risk management approach</div>
								</div>

								<div class="form-group">
									<label class="form-label">Describe Your Trading Strategy <span class="required">*</span></label>
									<textarea class="form-control" id="strategy" placeholder="Explain your trading strategy, approach to market analysis, and what makes your strategy unique..." required name="strategy"></textarea>
									<div class="error-message">Please describe your trading strategy</div>
								</div>

								<div class="form-group">
									<label class="form-label">Average Win Rate (%) <span class="required">*</span></label>
									<input type="number" class="form-control" id="winRate" placeholder="e.g., 65" min="0" max="100" required name="winRate">
									<div class="error-message">Please enter your average win rate</div>
								</div>
							</div>

							<!-- Step 4: Verification Documents -->
							<div class="form-step" data-step="4">
								<h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Verification Documents</h3>

								<div class="requirements-list">
									<h4>
										<i class="material-icons" style="font-size: 20px;">info</i>
										Required Documents
									</h4>
									<ul>
										<li>Trading statements from the last 6 months (PDF format)</li>
										<li>Government-issued ID (Passport, Driver's License, etc.)</li>
										<li>Proof of trading account (Screenshot showing account balance and history)</li>
										<li>All documents must be clear and legible</li>
									</ul>
								</div>

								<div class="form-group">
									<label class="form-label">Trading Statements (Last 6 Months) <span class="required">*</span></label>
									<div class="file-upload-area">
										<i class="material-icons">cloud_upload</i>
										<p><strong>Click to upload</strong> or drag and drop</p>
										<p style="font-size: 12px; color: #9ca3af;">PDF files only, max 10MB</p>
									</div>
									<input type="file" id="tradingStatements" accept=".pdf" style="display: none;" name="tradingStatements" onchange="handleFileUpload(this, 'statements-preview')">
									<div id="statements-preview"></div>
								</div>

								<div class="form-group">
									<label class="form-label">Government-Issued ID <span class="required">*</span></label>
									<div class="file-upload-area">
										<i class="material-icons">cloud_upload</i>
										<p><strong>Click to upload</strong> or drag and drop</p>
										<p style="font-size: 12px; color: #9ca3af;">JPG, PNG or PDF, max 5MB</p>
									</div>
									<input type="file" id="governmentId" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" name="governmentId" onchange="handleFileUpload(this, 'id-preview')">
									<div id="id-preview"></div>
								</div>

								<div class="form-group">
									<label class="form-label">Proof of Trading Account <span class="required">*</span></label>
									<div class="file-upload-area">
										<i class="material-icons">cloud_upload</i>
										<p><strong>Click to upload</strong> or drag and drop</p>
										<p style="font-size: 12px; color: #9ca3af;">JPG, PNG or PDF, max 5MB</p>
									</div>
									<input type="file" id="proofAccount" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" name="proofAccount" onchange="handleFileUpload(this, 'proof-preview')">
									<div id="proof-preview"></div>
								</div>
							</div>

							<!-- Step 5: Review & Submit -->
							<div class="form-step" data-step="5">
								<h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Review Your Application</h3>

								<div style="background: #f5f7fa; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
									<h4 style="font-size: 16px; font-weight: 700; margin-bottom: 15px; color: #1a1a1a;">Personal Information</h4>
									<div style="display: grid; gap: 10px; font-size: 14px;">
										<div><strong>Name:</strong> <span id="review-name">-</span></div>
										<div><strong>Email:</strong> <span id="review-email">-</span></div>
										<div><strong>Phone:</strong> <span id="review-phone">-</span></div>
										<div><strong>Country:</strong> <span id="review-country">-</span></div>
									</div>
								</div>

								<div style="background: #f5f7fa; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
									<h4 style="font-size: 16px; font-weight: 700; margin-bottom: 15px; color: #1a1a1a;">Trading Experience</h4>
									<div style="display: grid; gap: 10px; font-size: 14px;">
										<div><strong>Experience:</strong> <span id="review-experience">-</span></div>
										<div><strong>Trading Volume:</strong> <span id="review-volume">-</span></div>
										<div><strong>Trading Style:</strong> <span id="review-style">-</span></div>
										<div><strong>Risk Level:</strong> <span id="review-risk">-</span></div>
										<div><strong>Win Rate:</strong> <span id="review-winrate">-</span>%</div>
									</div>
								</div>

								<div style="background: #ecfdf5; border: 2px solid #10b981; padding: 20px; border-radius: 12px;">
									<label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer;">
										<input type="checkbox" id="agreeTerms" style="width: 20px; height: 20px; margin-top: 2px;" required>
										<span style="font-size: 14px; color: #1a1a1a;">
											I confirm that all information provided is accurate and true. I understand that false information may result in rejection or termination of my trader account. I agree to the <a href="#" style="color: #01A3FF; text-decoration: underline;">Terms and Conditions</a> for Copy Trading Leaders.
										</span>
									</label>
								</div>
							</div>

							<!-- Success Message -->
							<div class="form-step" data-step="6">
								<div class="success-animation">
									<i class="material-icons">check_circle</i>
									<h2>Application Submitted Successfully!</h2>
									<p>Thank you for applying to become a trader. Our team will review your application and get back to you within 3-5 business days.</p>
									<p style="margin-top: 20px;">
										<a href="{% url 'home' %}" class="btn btn-primary">
											<i class="material-icons">home</i>
											Back to Dashboard
										</a>
									</p>
								</div>
							</div>

							<!-- Navigation Buttons -->
							<div class="form-buttons">
								<button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
									<i class="material-icons">arrow_back</i>
									Previous
								</button>
								<button type="button" class="btn btn-primary" id="nextBtn">
									Next
									<i class="material-icons">arrow_forward</i>
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block page_scripts %}
<script>
// Multi-step form - UI ONLY (no validation, Django handles that)
let currentStep = 1;
const totalSteps = 5;

// Navigation buttons
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');

// Show/hide steps - UI ONLY
function showStep(step) {
	// Hide all steps
	document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
	document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));

	// Show current step
	const currentFormStep = document.querySelector(`.form-step[data-step="${step}"]`);
	const currentIndicator = document.querySelector(`.step[data-step="${step}"]`);

	if (currentFormStep) currentFormStep.classList.add('active');
	if (currentIndicator) currentIndicator.classList.add('active');

	// Mark completed steps (visual only)
	document.querySelectorAll('.step').forEach(s => {
		const stepNum = parseInt(s.getAttribute('data-step'));
		if (stepNum < step) {
			s.classList.add('completed');
		} else {
			s.classList.remove('completed');
		}
	});

	// Update button visibility
	prevBtn.style.display = (step === 1) ? 'none' : 'inline-flex';

	// Update Next button text
	if (step === totalSteps) {
		nextBtn.innerHTML = '<i class="material-icons">check</i> Submit Application';
	} else if (step === 6) {
		nextBtn.style.display = 'none';
		prevBtn.style.display = 'none';
	} else {
		nextBtn.innerHTML = 'Next <i class="material-icons">arrow_forward</i>';
	}
}

// Next button - just go to next step (no validation)
nextBtn.addEventListener('click', () => {
	if (currentStep < totalSteps) {
		currentStep++;
		showStep(currentStep);
	} else if (currentStep === totalSteps) {
		// For now, just show success (Django will handle actual submission later)
		// currentStep = 6;
		// showStep(currentStep);
		document.getElementById('traderApplicationForm').submit();
	}
});

// Previous button - just go back
prevBtn.addEventListener('click', () => {
	if (currentStep > 1) {
		currentStep--;
		showStep(currentStep);
	}
});

// File upload preview - UI ONLY
function handleFileUpload(input, previewId) {
	const preview = document.getElementById(previewId);
	const file = input.files[0];

	if (file) {
		preview.innerHTML = `
			<div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; margin-top: 10px;">
				<i class="material-icons" style="color: #22c55e;">check_circle</i>
				<span style="flex: 1;">${file.name}</span>
				<span style="color: #6b7280; font-size: 12px;">${(file.size / 1024).toFixed(2)} KB</span>
			</div>
		`;
	}
}

// Make file upload areas clickable
document.querySelectorAll('.file-upload-area').forEach((area, index) => {
	area.addEventListener('click', () => {
		const inputs = document.querySelectorAll('input[type="file"]');
		if (inputs[index]) inputs[index].click();
	});
});

// Initialize - show first step
showStep(currentStep);
</script>
{% endblock %}
